# 作业 #0：入门 — 操作步骤

## 任务-0.1 安装必备组件

### 1. 安装 Xmake

- 打开 [Xmake 官网](https://xmake.io/) 或 [GitHub Releases](https://github.com/xmake-io/xmake/releases)。
- **Windows**：下载安装包（如 `xmake-vx.x.x.win32.exe`）并安装，或使用包管理器：
  ```powershell
  winget install xmake
  ```
  安装后**重新打开终端**，执行 `xmake --version` 确认可用。

### 2. 安装 C++ 编译器（Windows 用 MSVC）

- **方式一（推荐）**：安装 [Visual Studio](https://visualstudio.microsoft.com/)（Community 版即可），在安装时勾选 **“使用 C++ 的桌面开发”**，会自动安装 MSVC。
- **方式二**：只装构建工具：下载 [Visual Studio Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)，安装时选择 “C++ 生成工具”。
- 编译时在 **“Developer Command Prompt for VS”** 或 **“x64 Native Tools Command Prompt”** 中运行 `xmake`，或在普通终端中先执行一次 `vcvarsall.bat` 再运行 `xmake`。

### 3. 安装 Python >= 3.9

- 要求 **Python ≥ 3.9**（作业说明要求，且 PyTorch/Transformers 需要）。
- 从 [python.org](https://www.python.org/downloads/) 下载并安装，勾选 “Add Python to PATH”。
- 安装后**升级 pip**（否则 `pip install ./python/` 可能报错找不到 setup.py）：
  ```powershell
  python -m pip install --upgrade pip
  ```

### 4. Clang-Format-16（可选）

- 仅用于 C++ 代码格式化，不做作业也可不装。
- 可从 [LLVM Releases](https://github.com/llvm/llvm-project/releases) 下载含 clang-format 的包，或使用包管理器安装。

---

## 任务-0.2 Fork 并构建 LLAISYS

### 1. Fork 并克隆仓库

1. 在 GitHub 上打开 LLAISYS 仓库，点击 **Fork** 到你自己的账号。
2. 克隆你 Fork 后的仓库（将 `YOUR_USERNAME` 换成你的 GitHub 用户名）：
   ```powershell
   git clone https://github.com/YOUR_USERNAME/llaisys.git
   cd llaisys
   ```

#### 已经直接 clone 了原仓库（如 `git clone https://github.com/InfiniTensor/llaisys.git`）怎么办？

可以继续用当前目录做作业，**本地编译、运行测试都没问题**。区别在于：

- 你现在没有对 **InfiniTensor/llaisys** 的推送权限，所以**不能**把作业直接 push 到原仓库。
- 若需要**在自己的 GitHub 上看到提交、跑 Actions 自动测试**，或后续按 `doc.md` 用 **exam-grading** 评分（把 llaisys 作为子模块/目录加进 exam-grading），需要有一个**你自己账号下的 llaisys 仓库**。

**做法：补一次 Fork，再把当前本地仓库对接到你的 Fork。**

1. **在 GitHub 上 Fork**  
   打开 https://github.com/InfiniTensor/llaisys ，点 **Fork**，得到 `https://github.com/你的用户名/llaisys`。

2. **在现有本地仓库里添加远程（在项目根目录执行）：**
   ```powershell
   # 把当前指向 InfiniTensor 的 origin 改名为 upstream（保留拉取原仓库更新的能力）
   git remote rename origin upstream

   # 把你自己的 Fork 设为 origin（将 你的用户名 换成你的 GitHub 用户名）
   git remote add origin https://github.com/你的用户名/llaisys.git
   ```

3. **之后推送作业到自己的仓库：**
   ```powershell
   git push -u origin main
   ```
   若默认分支是 `master` 则把 `main` 改成 `master`。这样 GitHub Actions 会在**你的** llaisys 仓库里跑，exam-grading 里也可以添加你这个 fork 的地址做评分（参考 `doc.md` 里“直接目录”或“子模块”方式）。

**小结：** 不 Fork 也能在本地完成作业；要 push、跑 Actions 或接入 exam-grading，按上面补 Fork 并改 remote 即可，无需重新 clone。

### 2. 编译和安装

在项目根目录（即包含 `xmake.lua` 的目录）下执行：

```powershell
# 1. 编译 C++ 代码
xmake

# 2. 安装 llaisys 共享库（会把 .dll 复制到 python/llaisys/libllaisys/）
xmake install

# 3. 安装 llaisys Python 包（需已升级 pip，且 Python >= 3.9）
pip install ./python/
```

**注意：**

- 若在普通 PowerShell 中运行 `xmake` 报错找不到 MSVC，请改用 **“x64 Native Tools Command Prompt for VS”** 再执行上述三条命令。
- 若 `pip install ./python/` 报错 `FileNotFoundError: ... setup.py`，请先执行 `python -m pip install --upgrade pip`，并确认当前 `python --version` 为 3.9 及以上。

### 3. 验证安装

```powershell
# 运行 CPU 运行时测试（与任务-0.3 一致）
python test/test_runtime.py --device cpu
```

若输出显示测试通过，说明 C++ 库和 Python 包安装成功。

---

## Github 自动测试

- 将代码 **push** 到你 Fork 的仓库后，Github Actions 会自动运行构建和测试。
- 在仓库页面打开 **Actions** 可查看每次 push/PR 的测试结果。
- 完成所有作业任务后，应保证 **所有测试通过**（与本地运行 `test/test_runtime.py`、`test/test_tensor.py`、`test/ops/*.py`、`test/test_infer.py --test` 一致）。

---

## 常见问题速查

| 问题 | 处理 |
|------|------|
| `xmake` 找不到或不是内部命令 | 安装 Xmake 后重开终端，或将 Xmake 安装目录加入 PATH。 |
| 编译报错找不到 MSVC | 使用 “x64 Native Tools Command Prompt” 或在终端先运行 VS 的 `vcvarsall.bat`。 |
| `pip install ./python/` 报错 setup.py | 执行 `python -m pip install --upgrade pip`，并确保 Python >= 3.9。 |
| 提示 Python 版本过低 | 安装 Python 3.9+ 并用该版本的 `python`/`pip` 执行上述命令。 |

按上述步骤完成即可做完 **作业 #0：入门** 的安装与构建部分。
